<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Neural Deck</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Top Bar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <header id="topbar">
    <div class="topbar-brand">
      <img class="brand-icon" src="ndicon.png" alt="Neural Deck" />
      <span class="brand-title">Neural Deck</span>
    </div>

    <div class="topbar-controls">
      <!-- VRAM Display -->
      <div id="vram-display" class="vram-stat" style="display: none;">
        <span class="vram-icon">VRAM</span>
        <span id="vram-count">--</span>
      </div>

      <div class="input-group provider-group">
        <label for="provider-select">Provider</label>
        <select id="provider-select">
          <option value="ollama">Ollama</option>
          <option value="lmstudio">LM Studio</option>
        </select>
      </div>

      <div class="input-group server-group">
        <label for="server-url">Server</label>
        <input type="text" id="server-url" value="http://localhost:11434" spellcheck="false" />
      </div>

      <div class="input-group model-group">
        <label for="model-select">Model</label>
        <select id="model-select">
          <option value="">‚Äî select model ‚Äî</option>
        </select>
      </div>

      <button id="btn-refresh" title="Refresh models">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round">
          <polyline points="23 4 23 10 17 10" />
          <polyline points="1 20 1 14 7 14" />
          <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
        </svg>
      </button>

      <button id="btn-toggle-settings" title="Settings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round">
          <circle cx="12" cy="12" r="3" />
          <path
            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.32 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" />
        </svg>
      </button>
    </div>
  </header>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Main Layout ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="app">
    <!-- Settings Sidebar -->
    <aside id="sidebar" class="open">
      <div class="param-group">
        <label for="agent-name">Agent Name</label>
        <input type="text" id="agent-name" value="Sojourner" spellcheck="false" />
        <p class="param-hint">Display name for the AI in chat</p>
      </div>

      <h2>Parameters</h2>

      <div class="param-group">
        <label for="temperature">Temperature <span id="temp-value" class="param-value">0.7</span></label>
        <input type="range" id="temperature" min="0" max="2" step="0.05" value="0.7" />
        <div class="range-labels"><span>Precise</span><span>Creative</span></div>
      </div>

      <div class="param-group">
        <label for="max-tokens">Max Tokens</label>
        <input type="number" id="max-tokens" min="1" max="128000" value="2048" />
        <p class="param-hint">Maximum number of tokens to generate</p>
      </div>

      <div class="param-group">
        <label for="context-length">Context Length</label>
        <input type="number" id="context-length" min="256" max="131072" value="4096" />
        <p class="param-hint">Size of the context window (num_ctx)</p>
      </div>

      <div class="param-group toggle-group">
        <label for="stream-toggle">Stream Response</label>
        <label class="toggle-switch">
          <input type="checkbox" id="stream-toggle" checked />
          <span class="toggle-slider"></span>
        </label>
        <p class="param-hint">Stream tokens in real-time vs. wait for full response</p>
      </div>

      <div class="param-group toggle-group">
        <label for="webtools-toggle">Web Tools</label>
        <label class="toggle-switch">
          <input type="checkbox" id="webtools-toggle" checked />
          <span class="toggle-slider"></span>
        </label>
        <p class="param-hint">Allow üîß models to call web APIs (weather, time, search). Off = local only</p>
      </div>

      <h2>History</h2>

      <div class="param-group">
        <label for="history-mode">History Storage</label>
        <select id="history-mode">
          <option value="memory">Memory</option>
          <option value="disk">Disk</option>
        </select>
        <p class="param-hint">Memory: lost on close. Disk: persisted locally</p>
      </div>

      <div class="param-group toggle-group" id="encrypt-group" style="display:none;">
        <label for="encrypt-toggle">Encrypt History</label>
        <label class="toggle-switch">
          <input type="checkbox" id="encrypt-toggle" />
          <span class="toggle-slider"></span>
        </label>
        <p class="param-hint">AES-256-GCM encryption with your passphrase</p>
      </div>

      <div class="param-group">
        <label for="chunk-size">Chunk Size</label>
        <input type="number" id="chunk-size" min="1" max="4096" value="512" />
        <p class="param-hint">Batch size for prompt processing (num_batch)</p>
      </div>

      <div class="param-group">
        <label for="prompt-mode">System Prompt</label>
        <select id="prompt-mode">
          <option value="default">Default</option>
          <option value="none">None</option>
          <option value="custom">Custom</option>
        </select>
        <p class="param-hint">Default: Sojourner persona. Custom: your own prompt</p>
      </div>

      <div class="param-group" id="custom-prompt-group" style="display:none;">
        <label for="system-prompt">Custom Prompt</label>
        <textarea id="system-prompt" rows="6" placeholder="Enter your custom system prompt‚Ä¶"></textarea>
      </div>

      <button id="btn-clear" class="btn-secondary">Clear Chat</button>
      <button id="btn-reset" class="btn-secondary btn-danger" style="margin-top: 10px;">Reset Protocols</button>
    </aside>

    <!-- Chat Area -->
    <main id="chat-area">
      <div id="loader-overlay">
        <div class="loader-card">
          <div class="loader-content">
            <div id="loader-text" class="hack-blink">INITIALIZING NEURAL LINK...</div>
            <div class="loader-track">
              <div class="loader-bar"></div>
            </div>
          </div>
        </div>
      </div>
      <div id="messages">
        <div class="welcome-message">
          <div class="welcome-icon">
            <img src="ndlogo.png" alt="Neural Deck" />
          </div>
          <h2>Welcome to Neural Deck</h2>
          <p>Connect to your Ollama server, pick a model, and start chatting.</p>
        </div>
      </div>

      <!-- Input Bar -->
      <div id="attachments-preview" class="hidden"></div>
      <div id="input-bar">
        <button id="btn-attach-image" title="Attach image for vision models">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
            <circle cx="8.5" cy="8.5" r="1.5" />
            <polyline points="21 15 16 10 5 21" />
          </svg>
        </button>
        <button id="btn-attach-file" title="Attach file">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round">
            <path
              d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48" />
          </svg>
        </button>
        <div class="emoji-picker-wrapper">
          <button id="btn-emoji" title="Emoji picker">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <circle cx="12" cy="12" r="10" />
              <path d="M8 14s1.5 2 4 2 4-2 4-2" />
              <line x1="9" y1="9" x2="9.01" y2="9" />
              <line x1="15" y1="9" x2="15.01" y2="9" />
            </svg>
          </button>
          <div id="emoji-panel" class="hidden"></div>
        </div>
        <textarea id="user-input" rows="1" placeholder="Type your message‚Ä¶" autofocus></textarea>
        <button id="btn-send" title="Send">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round">
            <line x1="22" y1="2" x2="11" y2="13" />
            <polygon points="22 2 15 22 11 13 2 9 22 2" />
          </svg>
        </button>
        <button id="btn-stop" title="Stop generation" class="hidden">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <rect x="4" y="4" width="16" height="16" rx="2" />
          </svg>
        </button>
      </div>
    </main>
  </div>

  <div id="status-bar">
    <span id="status-text">Disconnected</span>
  </div>

  <!-- Encryption Key Modal -->
  <div id="key-modal" class="modal-overlay hidden">
    <div class="modal-card">
      <h3>üîê Encryption Passphrase</h3>
      <p class="modal-hint">Enter your passphrase for chat history encryption. This is never stored on disk.</p>
      <input type="password" id="key-input" placeholder="Enter passphrase‚Ä¶" spellcheck="false" autocomplete="off" />
      <div class="modal-actions">
        <button id="key-cancel" class="btn-modal btn-modal-cancel">Cancel</button>
        <button id="key-ok" class="btn-modal btn-modal-ok">Unlock</button>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div id="confirm-modal" class="modal-overlay hidden">
    <div class="modal-card confirm-card">
      <h3 id="confirm-title">‚ö†Ô∏è CONFIRM ACTION</h3>
      <p id="confirm-message" class="modal-hint">Are you sure you want to proceed?</p>
      <div class="modal-actions">
        <button id="confirm-cancel" class="btn-modal btn-modal-cancel">ABORT</button>
        <button id="confirm-ok" class="btn-modal btn-danger">EXECUTE</button>
      </div>
    </div>
  </div>

  <script src="hack-commands.js"></script>
  <script src="renderer.js"></script>
</body>

</html>